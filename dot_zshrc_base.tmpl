# vim: syntax=bash
#

# Oh My Zsh settings
DISABLE_AUTO_UPDATE="true"
export ZSH=$HOME/.oh-my-zsh

# Make sure autojumo is loaded
[ -f /opt/homebrew/etc/profile.d/autojump.sh ] && . /opt/homebrew/etc/profile.d/autojump.sh

# ZSH_THEME="powerlevel10k/powerlevel10k"
plugins=(history fzf iterm2 sudo zsh-syntax-highlighting zsh-autosuggestions autojump)

## Plugin configuration
if command -v git &>/dev/null; then
  plugins+=("git");
fi

if [[ (-x /usr/bin/grc || -x /usr/local/bin/grc) && -f /etc/grc.zsh ]]; then
  plugins+=("grc");
fi

if [[ -x ${HOME}/.local/bin/poetry ]]; then
  plugins+=("poetry");
fi

if [[ -d ${HOME}/.pyenv ]]; then
  export PYENV_ROOT="${HOME}/.pyenv"
  export PATH="${PYENV_ROOT}/bin:$PATH"
  eval "$(pyenv init --path)"
  plugins+=("pyenv");
fi

if command -v eza &>/dev/null; then
  plugins+=("eza");
fi

if command -v kubecm &>/dev/null; then
  alias kc="kubecm"
  alias ks="kubecm switch"
  alias kn="kubecm namespace"
fi

if command -v code &>/dev/null; then
  plugins+=("vscode");
fi

if command -v kubectl &>/dev/null; then
  plugins+=("kubectl");
fi

if command -v gpg-agent &>/dev/null; then
  plugins+=("gpg-agent");
fi

if command -v sagecipher &>/dev/null; then
  export PYTHON_KEYRING_BACKEND=sagecipher.keyring.Keyring
  export KEYRING_PROPERTY_SSH_KEY_FINGERPRINT=$(sagecipher list-keys | awk '{print $2}')
fi

if [[ -d ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k ]]; then
  export ZSH_THEME="powerlevel10k/powerlevel10k"
  # resource oh-my-zsh to activate the theme

  # Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
  # Initialization code that may require console input (password prompts, [y/n]
  # confirmations, etc.) must go above this block; everything else may go below.
  if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
    source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
  fi
  
# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
  [[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
fi

source $ZSH/oh-my-zsh.sh <$TTY

# Define baseline aliases

alias cz="chezmoi"
alias czb='chezmoi --source "${USER_HOME:-$HOME}/.local/share/chezmoi.base" --config ${USER_HOME:-$HOME}/.config/chezmoi/_base/chezmoi.yaml "${@}"'

